<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AirQuality</title>
    <!-- meta -->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- styles -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous"
    >
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
          integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
          crossorigin=""/>
   <style>
      #mapid {
        width: 900px; height: 400px; position: relative;
      }
      .grafica {
        width: 60%;
        height: 100%;
        position: relative;
        display: -webkit-inline-box;
        margin-bottom: 100px;
    }
   </style>
  </head>
  <body>
      <div class="container">
      <div class="">
        <br>
        <h3 class="title"> Mapa de Calidad del Aire Cartagena</h3>
        <hr><br>
        <div id="mapid"></div>

        <div class="grafica">
           <span>Evolución del estado durante el día</span>
            <canvas id="myChart"></canvas>
        </div>

        </div>
      </div>
    </div>

   <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
           integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
           crossorigin=""></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>

   <script type="text/javascript">
       const map = L.map('mapid').setView([10.4111576,-75.5052369], 13);
       L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		            maxZoom: 18,
		            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			          '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			         'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		           id: 'mapbox.streets'
	    }).addTo(map);

       L.marker([10.398, -75.483]).addTo(map)
    		.bindPopup("<b>Estación:</b> Santa Lucia</br> <b>Estado:</b> Aceptable</br><b>Causa:</b> PM2.5</br><b>Valor:</b> 32.5 um/g").openPopup();


        // Charjs
        fetch('http://0.0.0.0:5000/stations')
            .then(function(response) {
              return response.json();
            })
            .then(function(result) {
              const resp = result.weather.station;
              let date = [];
              let source1 = [];
              resp.map((r)=>{
                  date.push(r.date)
                  source1.push(r.pm2);
              })
              console.log(date)
              var ctx = document.getElementById("myChart").getContext("2d");
              var myChart = new Chart(ctx, {
                 type: 'line',
                 data: {
                    labels: date,
                    datasets: [{
                       label: "PM2.5 - (um/g)",
                       data: source1,
                       borderWidth: 2,
                       backgroundColor: "rgba(6, 167, 125, 0.1)",
                       borderColor: "rgba(6, 167, 125, 1)",
                       pointBackgroundColor: "rgba(225, 225, 225, 1)",
                       pointBorderColor: "rgba(6, 167, 125, 1)",
                       pointHoverBackgroundColor: "rgba(6, 167, 125, 1)",
                       pointHoverBorderColor: "#fff"
                    }]
                 },
                 options: {
                   scales: {
                     xAxes: [{
                         ticks: {
                          callback: function (value, index, values) {
                            return new Date(value).toLocaleDateString('en-US',{month:'long',day: 'numeric', year:'numeric'})

                           }
                        }
                   }]
                 },

               }

            });
         })
  </script>
  </body>
</html>
